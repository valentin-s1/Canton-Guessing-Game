# game.py - Core game logic for the Swiss Canton Guessing Game
import streamlit as st
import random
import pandas as pd
import time
from streamlit_autorefresh import st_autorefresh

# Load canton data from the provided Excel structure
def load_canton_data():
    cantons = {
        "Aargau": {
            "Population (2022)": "685,000",
            "Capital": "Aarau",
            "Official Language": "German",
            "Year Joined": "1803",
            "Area (kmÂ²)": "1,404",
            "Highest Point": "Geissfluegrat (908m)",
            "Famous Dish": "RÃ¼eblitorte",
            "Traditional Festival": "RÃ¼eblimÃ¤rt",
            "Bordering Cantons (names)": "ZÃ¼rich, Zug, Luzern, Bern, Solothurn, Basel-Landschaft",
            "Bordering Cantons (no)": "6",
            "Famous Person": "Johann Heinrich Pestalozzi",
            "Notable Landmark": "Habsburg Castle",
            "Main Industries": "Pharmaceuticals",
            "UNESCO Heritage": "None",
            "Lake/River": "Aare River",
            "Mountain Pass": "None",
            "Nickname": "The Energy Canton",
            "Traditional Costume": "Aargauer Tracht",
            "Unique Fact": "Home to many nuclear power plants"
        },
        "Appenzell Ausserrhoden": {
            "Population (2022)": "55,000",
            "Capital": "Herisau",
            "Official Language": "German",
            "Year Joined": "1513",
            "Area (kmÂ²)": "243",
            "Highest Point": "SÃ¤ntis (2,502m)",
            "Famous Dish": "Appenzeller Biberli",
            "Traditional Festival": "Alpfahrt",
            "Bordering Cantons (names)": "Appenzell Innerrhoden, St. Gallen",
            "Bordering Cantons (no)": "2",
            "Famous Person": "-",
            "Notable Landmark": "SÃ¤ntis mountain",
            "Main Industries": "Dairy farming",
            "UNESCO Heritage": "None",
            "Lake/River": "-",
            "Mountain Pass": "None",
            "Nickname": "Landsgemeinde Canton",
            "Traditional Costume": "Appenzeller Tracht",
            "Unique Fact": "One of last to grant women's vote (1989)"
        },
        "Appenzell Innerrhoden": {
            "Population (2022)": "16,000",
            "Capital": "Appenzell",
            "Official Language": "German",
            "Year Joined": "1513",
            "Area (kmÂ²)": "173",
            "Highest Point": "SÃ¤ntis (2,502m)",
            "Famous Dish": "Appenzeller KÃ¤se",
            "Traditional Festival": "Landsgemeinde",
            "Bordering Cantons (names)": "Appenzell Ausserrhoden, St. Gallen",
            "Bordering Cantons (no)": "2",
            "Famous Person": "-",
            "Notable Landmark": "Appenzell village center",
            "Main Industries": "Tourism",
            "UNESCO Heritage": "None",
            "Lake/River": "-",
            "Mountain Pass": "None",
            "Nickname": "Most Traditional",
            "Traditional Costume": "Colorful Appenzeller",
            "Unique Fact": "Last to grant women's vote (1991)"
        },
        "Basel-Landschaft": {
            "Population (2022)": "290,000",
            "Capital": "Liestal",
            "Official Language": "German",
            "Year Joined": "1833",
            "Area (kmÂ²)": "518",
            "Highest Point": "Hinteri Egg (1,169m)",
            "Famous Dish": "Basler LÃ¤ckerli",
            "Traditional Festival": "Vogel Gryff",
            "Bordering Cantons (names)": "Basel-Stadt, Solothurn, Aargau, Jura",
            "Bordering Cantons (no)": "4",
            "Famous Person": "Karl Barth",
            "Notable Landmark": "Augusta Raurica",
            "Main Industries": "Pharmaceuticals",
            "UNESCO Heritage": "None",
            "Lake/River": "Rhine River",
            "Mountain Pass": "None",
            "Nickname": "The Half-Canton",
            "Traditional Costume": "Baselbieter Tracht",
            "Unique Fact": "Split from Basel-Stadt in 1833"
        },
        "Basel-Stadt": {
            "Population (2022)": "200,000",
            "Capital": "Basel",
            "Official Language": "German",
            "Year Joined": "1501",
            "Area (kmÂ²)": "37",
            "Highest Point": "St. Chrischona (522m)",
            "Famous Dish": "Basler Mehlsuppe",
            "Traditional Festival": "Fasnacht",
            "Bordering Cantons (names)": "Basel-Landschaft",
            "Bordering Cantons (no)": "1",
            "Famous Person": "Roger Federer",
            "Notable Landmark": "Basel Minster",
            "Main Industries": "Banking, Art",
            "UNESCO Heritage": "None",
            "Lake/River": "Rhine River",
            "Mountain Pass": "None",
            "Nickname": "Cultural Capital",
            "Traditional Costume": "Basler Tracht",
            "Unique Fact": "Hosts Art Basel"
        },
        "Bern": {
            "Population (2022)": "1,040,000",
            "Capital": "Bern",
            "Official Language": "German, French",
            "Year Joined": "1353",
            "Area (kmÂ²)": "5,960",
            "Highest Point": "Finsteraarhorn (4,274m)",
            "Famous Dish": "Berner Platte",
            "Traditional Festival": "ZibelemÃ¤rit",
            "Bordering Cantons (names)": "11 cantons",
            "Bordering Cantons (no)": "11",
            "Famous Person": "Albert Einstein",
            "Notable Landmark": "Federal Palace",
            "Main Industries": "Government",
            "UNESCO Heritage": "Old City of Bern",
            "Lake/River": "Aare River",
            "Mountain Pass": "Grimsel, Susten",
            "Nickname": "Federal City",
            "Traditional Costume": "Berner Tracht",
            "Unique Fact": "Most bordering cantons"
        },
        "Fribourg": {
            "Population (2022)": "325,000",
            "Capital": "Fribourg",
            "Official Language": "French, German",
            "Year Joined": "1481",
            "Area (kmÂ²)": "1,671",
            "Highest Point": "Vanil Noir (2,389m)",
            "Famous Dish": "Fribourger Fondue",
            "Traditional Festival": "Belluard Festival",
            "Bordering Cantons (names)": "Vaud, NeuchÃ¢tel, Bern, Valais",
            "Bordering Cantons (no)": "4",
            "Famous Person": "Jean Tinguely",
            "Notable Landmark": "GruyÃ¨res Castle",
            "Main Industries": "Cheese production",
            "UNESCO Heritage": "GruyÃ¨res region",
            "Lake/River": "Lake of GruyÃ¨re",
            "Mountain Pass": "None",
            "Nickname": "The Bilingual",
            "Traditional Costume": "Fribourger Tracht",
            "Unique Fact": "Officially bilingual"
        },
        "Geneva": {
            "Population (2022)": "504,000",
            "Capital": "Geneva",
            "Official Language": "French",
            "Year Joined": "1815",
            "Area (kmÂ²)": "282",
            "Highest Point": "Les Arales (516m)",
            "Famous Dish": "Longeole sausage",
            "Traditional Festival": "Escalade",
            "Bordering Cantons (names)": "Vaud, France",
            "Bordering Cantons (no)": "2",
            "Famous Person": "Jean-Jacques Rousseau",
            "Notable Landmark": "Jet d'Eau",
            "Main Industries": "Diplomacy, Banking",
            "UNESCO Heritage": "None",
            "Lake/River": "Lake Geneva",
            "Mountain Pass": "None",
            "Nickname": "Peace Capital",
            "Traditional Costume": "Genevois costume",
            "Unique Fact": "HQ of Red Cross/UN"
        },
        "Glarus": {
            "Population (2022)": "40,000",
            "Capital": "Glarus",
            "Official Language": "German",
            "Year Joined": "1352",
            "Area (kmÂ²)": "685",
            "Highest Point": "TÃ¶di (3,614m)",
            "Famous Dish": "Glarner Pastetli",
            "Traditional Festival": "None",
            "Bordering Cantons (names)": "St. Gallen, GraubÃ¼nden, Uri, Schwyz",
            "Bordering Cantons (no)": "4",
            "Famous Person": "-",
            "Notable Landmark": "Martinsloch (rock window)",
            "Main Industries": "Textiles",
            "UNESCO Heritage": "None",
            "Lake/River": "Linth River",
            "Mountain Pass": "Klausenpass",
            "Nickname": "The Industrial Pioneer",
            "Traditional Costume": "Glarner Tracht",
            "Unique Fact": "First labor laws (1864)"
        },
        "GraubÃ¼nden": {
            "Population (2022)": "200,000",
            "Capital": "Chur",
            "Official Language": "German, Romansh, Italian",
            "Year Joined": "1803",
            "Area (kmÂ²)": "7,105",
            "Highest Point": "Piz Bernina (4,049m)",
            "Famous Dish": "Capuns",
            "Traditional Festival": "Chalandamarz",
            "Bordering Cantons (names)": "St. Gallen, Glarus, Uri, Ticino, Valais",
            "Bordering Cantons (no)": "5",
            "Famous Person": "Alois Carigiet",
            "Notable Landmark": "Bernina Railway",
            "Main Industries": "Tourism",
            "UNESCO Heritage": "Rhaetian Railway",
            "Lake/River": "Rhine River",
            "Mountain Pass": "Julier, Bernina",
            "Nickname": "The Mountain Kingdom",
            "Traditional Costume": "BÃ¼ndner Tracht",
            "Unique Fact": "Only trilingual canton"
        },
        "Jura": {
            "Population (2022)": "73,000",
            "Capital": "DelÃ©mont",
            "Official Language": "French",
            "Year Joined": "1979",
            "Area (kmÂ²)": "838",
            "Highest Point": "Mont Raimeux (1,302m)",
            "Famous Dish": "Jura sausage",
            "Traditional Festival": "None",
            "Bordering Cantons (names)": "Basel-Landschaft, Solothurn, Bern, NeuchÃ¢tel",
            "Bordering Cantons (no)": "4",
            "Famous Person": "Charles-Ferdinand Ramuz",
            "Notable Landmark": "Franches-Montagnes",
            "Main Industries": "Watchmaking",
            "UNESCO Heritage": "None",
            "Lake/River": "Doubs River",
            "Mountain Pass": "None",
            "Nickname": "The Youngest Canton",
            "Traditional Costume": "Jurassien costume",
            "Unique Fact": "Youngest canton (created 1979)"
        },
        "Lucerne": {
            "Population (2022)": "420,000",
            "Capital": "Lucerne",
            "Official Language": "German",
            "Year Joined": "1332",
            "Area (kmÂ²)": "1,493",
            "Highest Point": "Brienzer Rothorn (2,350m)",
            "Famous Dish": "Luzerner ChÃ¼gelipastete",
            "Traditional Festival": "Luzerner Fasnacht",
            "Bordering Cantons (names)": "Aargau, Zug, Schwyz, Obwalden, Nidwalden, Bern",
            "Bordering Cantons (no)": "6",
            "Famous Person": "Hans Erni",
            "Notable Landmark": "Chapel Bridge",
            "Main Industries": "Tourism",
            "UNESCO Heritage": "None",
            "Lake/River": "Lake Lucerne",
            "Mountain Pass": "BrÃ¼nigpass",
            "Nickname": "The Lake Canton",
            "Traditional Costume": "Luzerner Tracht",
            "Unique Fact": "Home to Swiss Transport Museum"
        },
        "NeuchÃ¢tel": {
            "Population (2022)": "176,000",
            "Capital": "NeuchÃ¢tel",
            "Official Language": "French",
            "Year Joined": "1815",
            "Area (kmÂ²)": "803",
            "Highest Point": "Chasseral (1,607m)",
            "Famous Dish": "Å’ufs Ã  la NeuchÃ¢teloise",
            "Traditional Festival": "FÃªte des Vendanges",
            "Bordering Cantons (names)": "Vaud, Fribourg, Bern, Jura, France",
            "Bordering Cantons (no)": "4",
            "Famous Person": "Louis Chevrolet",
            "Notable Landmark": "NeuchÃ¢tel Castle",
            "Main Industries": "Watchmaking",
            "UNESCO Heritage": "None",
            "Lake/River": "Lake NeuchÃ¢tel",
            "Mountain Pass": "None",
            "Nickname": "The Watchmaking Hub",
            "Traditional Costume": "NeuchÃ¢telois costume",
            "Unique Fact": "Republic until 1848"
        },
        "Nidwalden": {
            "Population (2022)": "43,000",
            "Capital": "Stans",
            "Official Language": "German",
            "Year Joined": "1291",
            "Area (kmÂ²)": "276",
            "Highest Point": "RotstÃ¶ckli (2,901m)",
            "Famous Dish": "Nidwaldner Torte",
            "Traditional Festival": "None",
            "Bordering Cantons (names)": "Obwalden, Lucerne, Schwyz, Uri",
            "Bordering Cantons (no)": "4",
            "Famous Person": "-",
            "Notable Landmark": "Stanserhorn",
            "Main Industries": "Agriculture",
            "UNESCO Heritage": "None",
            "Lake/River": "Lake Lucerne",
            "Mountain Pass": "None",
            "Nickname": "The Forest Canton",
            "Traditional Costume": "Nidwaldner Tracht",
            "Unique Fact": "Founding canton (Uri-Schwyz-Nidwalden)"
        },
        "Obwalden": {
            "Population (2022)": "38,000",
            "Capital": "Sarnen",
            "Official Language": "German",
            "Year Joined": "1291",
            "Area (kmÂ²)": "491",
            "Highest Point": "Titlis (3,238m)",
            "Famous Dish": "Obwaldner Birnbrot",
            "Traditional Festival": "None",
            "Bordering Cantons (names)": "Nidwalden, Lucerne, Bern, Uri",
            "Bordering Cantons (no)": "4",
            "Famous Person": "-",
            "Notable Landmark": "Engelberg Abbey",
            "Main Industries": "Tourism",
            "UNESCO Heritage": "None",
            "Lake/River": "Lake Sarnen",
            "Mountain Pass": "BrÃ¼nigpass",
            "Nickname": "The Alpine Canton",
            "Traditional Costume": "Obwaldner Tracht",
            "Unique Fact": "Founding canton"
        },
        "Schaffhausen": {
            "Population (2022)": "83,000",
            "Capital": "Schaffhausen",
            "Official Language": "German",
            "Year Joined": "1501",
            "Area (kmÂ²)": "298",
            "Highest Point": "Hagen (912m)",
            "Famous Dish": "Schaffhauser Zigerkrapfen",
            "Traditional Festival": "None",
            "Bordering Cantons (names)": "ZÃ¼rich, Thurgau, Germany",
            "Bordering Cantons (no)": "2",
            "Famous Person": "Johann Conrad Fischer",
            "Notable Landmark": "Rhine Falls",
            "Main Industries": "Industry",
            "UNESCO Heritage": "None",
            "Lake/River": "Rhine River",
            "Mountain Pass": "None",
            "Nickname": "The Rhine Canton",
            "Traditional Costume": "Schaffhauser Tracht",
            "Unique Fact": "Home to Europe's largest waterfall"
        },
        "Schwyz": {
            "Population (2022)": "160,000",
            "Capital": "Schwyz",
            "Official Language": "German",
            "Year Joined": "1291",
            "Area (kmÂ²)": "908",
            "Highest Point": "BÃ¶s Fulen (2,802m)",
            "Famous Dish": "Schwyzer Cholera",
            "Traditional Festival": "None",
            "Bordering Cantons (names)": "Uri, Glarus, St. Gallen, Zug, ZÃ¼rich, Lucerne",
            "Bordering Cantons (no)": "6",
            "Famous Person": "Heinrich Federer",
            "Notable Landmark": "Bundesbriefmuseum",
            "Main Industries": "Agriculture",
            "UNESCO Heritage": "None",
            "Lake/River": "Lake Zurich",
            "Mountain Pass": "Pragelpass",
            "Nickname": "The Founding Canton",
            "Traditional Costume": "Schwyzer Tracht",
            "Unique Fact": "Namesake of Switzerland"
        },
        "Solothurn": {
            "Population (2022)": "280,000",
            "Capital": "Solothurn",
            "Official Language": "German",
            "Year Joined": "1481",
            "Area (kmÂ²)": "790",
            "Highest Point": "Hasenmatt (1,445m)",
            "Famous Dish": "Solothurner Torte",
            "Traditional Festival": "None",
            "Bordering Cantons (names)": "Basel-Landschaft, Aargau, Bern, Jura",
            "Bordering Cantons (no)": "4",
            "Famous Person": "C.F. Meyer",
            "Notable Landmark": "St. Ursen Cathedral",
            "Main Industries": "Machine industry",
            "UNESCO Heritage": "None",
            "Lake/River": "Aare River",
            "Mountain Pass": "None",
            "Nickname": "The Ambassadors' Canton",
            "Traditional Costume": "Solothurner Tracht",
            "Unique Fact": "Former residence of French ambassadors"
        },
        "St. Gallen": {
            "Population (2022)": "510,000",
            "Capital": "St. Gallen",
            "Official Language": "German",
            "Year Joined": "1803",
            "Area (kmÂ²)": "2,031",
            "Highest Point": "Ringelspitz (3,247m)",
            "Famous Dish": "St. Galler Bratwurst",
            "Traditional Festival": "OLMA Fair",
            "Bordering Cantons (names)": "Appenzell AR, Appenzell IR, GraubÃ¼nden, Glarus, Schwyz, Thurgau, ZÃ¼rich",
            "Bordering Cantons (no)": "7",
            "Famous Person": "Vadian",
            "Notable Landmark": "Abbey Library",
            "Main Industries": "Textiles",
            "UNESCO Heritage": "Abbey of St. Gall",
            "Lake/River": "Lake Constance",
            "Mountain Pass": "None",
            "Nickname": "The Textile Canton",
            "Traditional Costume": "St. Galler Tracht",
            "Unique Fact": "Famous for embroidery"
        },
        "Thurgau": {
            "Population (2022)": "280,000",
            "Capital": "Frauenfeld",
            "Official Language": "German",
            "Year Joined": "1803",
            "Area (kmÂ²)": "992",
            "Highest Point": "Hohgrat (996m)",
            "Famous Dish": "Thurgauer RÃ¼eblitorte",
            "Traditional Festival": "None",
            "Bordering Cantons (names)": "St. Gallen, ZÃ¼rich, Schaffhausen",
            "Bordering Cantons (no)": "3",
            "Famous Person": "-",
            "Notable Landmark": "Kartause Ittingen",
            "Main Industries": "Agriculture",
            "UNESCO Heritage": "None",
            "Lake/River": "Lake Constance",
            "Mountain Pass": "None",
            "Nickname": "The Orchard Canton",
            "Traditional Costume": "Thurgauer Tracht",
            "Unique Fact": "Known for apple orchards"
        },
        "Ticino": {
            "Population (2022)": "350,000",
            "Capital": "Bellinzona",
            "Official Language": "Italian",
            "Year Joined": "1803",
            "Area (kmÂ²)": "2,812",
            "Highest Point": "Rheinwaldhorn (3,402m)",
            "Famous Dish": "Risotto",
            "Traditional Festival": "None",
            "Bordering Cantons (names)": "Uri, Valais, GraubÃ¼nden",
            "Bordering Cantons (no)": "3",
            "Famous Person": "Mario Botta",
            "Notable Landmark": "Bellinzona Castles",
            "Main Industries": "Tourism",
            "UNESCO Heritage": "Bellinzona Castles",
            "Lake/River": "Lake Lugano",
            "Mountain Pass": "Gotthard Pass",
            "Nickname": "The Italian Canton",
            "Traditional Costume": "Ticinese costume",
            "Unique Fact": "Only Italian-speaking canton"
        },
        "Uri": {
            "Population (2022)": "36,000",
            "Capital": "Altdorf",
            "Official Language": "German",
            "Year Joined": "1291",
            "Area (kmÂ²)": "1,077",
            "Highest Point": "Dammastock (3,630m)",
            "Famous Dish": "Urner Cholera",
            "Traditional Festival": "None",
            "Bordering Cantons (names)": "Schwyz, Glarus, GraubÃ¼nden, Ticino, Valais, Nidwalden, Obwalden",
            "Bordering Cantons (no)": "7",
            "Famous Person": "Wilhelm Tell",
            "Notable Landmark": "Tellskapelle",
            "Main Industries": "Hydroelectric power",
            "UNESCO Heritage": "None",
            "Lake/River": "Lake Uri",
            "Mountain Pass": "Gotthard Pass",
            "Nickname": "The Heart of Switzerland",
            "Traditional Costume": "Urner Tracht",
            "Unique Fact": "Legendary home of William Tell"
        },
        "Valais": {
            "Population (2022)": "350,000",
            "Capital": "Sion",
            "Official Language": "French, German",
            "Year Joined": "1815",
            "Area (kmÂ²)": "5,224",
            "Highest Point": "Dufourspitze (4,634m)",
            "Famous Dish": "Raclette",
            "Traditional Festival": "Cow fights",
            "Bordering Cantons (names)": "Vaud, Bern, Uri, Ticino",
            "Bordering Cantons (no)": "4",
            "Famous Person": "Maurice BÃ©jart",
            "Notable Landmark": "Matterhorn",
            "Main Industries": "Wine production",
            "UNESCO Heritage": "Jungfrau-Aletsch region",
            "Lake/River": "RhÃ´ne River",
            "Mountain Pass": "Simplon Pass",
            "Nickname": "The Wine Canton",
            "Traditional Costume": "Walliser Tracht",
            "Unique Fact": "Home to 45 four-thousanders"
        },
        "Vaud": {
            "Population (2022)": "830,000",
            "Capital": "Lausanne",
            "Official Language": "French",
            "Year Joined": "1803",
            "Area (kmÂ²)": "3,212",
            "Highest Point": "Diablerets (3,210m)",
            "Famous Dish": "Papet Vaudois",
            "Traditional Festival": "FÃªte de la Vigne",
            "Bordering Cantons (names)": "Geneva, Valais, Fribourg, NeuchÃ¢tel, Bern",
            "Bordering Cantons (no)": "5",
            "Famous Person": "Coco Chanel",
            "Notable Landmark": "Olympic Museum",
            "Main Industries": "Hospitality",
            "UNESCO Heritage": "Lavaux Vineyards",
            "Lake/River": "Lake Geneva",
            "Mountain Pass": "Col du Pillon",
            "Nickname": "The Olympic Capital",
            "Traditional Costume": "Vaudois costume",
            "Unique Fact": "Hosted 1924/2020 Youth Olympics"
        },
        "Zug": {
            "Population (2022)": "130,000",
            "Capital": "Zug",
            "Official Language": "German",
            "Year Joined": "1352",
            "Area (kmÂ²)": "239",
            "Highest Point": "Wildspitz (1,580m)",
            "Famous Dish": "Zuger Kirschtorte",
            "Traditional Festival": "None",
            "Bordering Cantons (names)": "ZÃ¼rich, Schwyz, Lucerne, Aargau",
            "Bordering Cantons (no)": "4",
            "Famous Person": "-",
            "Notable Landmark": "Zug Castle",
            "Main Industries": "Finance",
            "UNESCO Heritage": "None",
            "Lake/River": "Lake Zug",
            "Mountain Pass": "None",
            "Nickname": "The Cherry Canton",
            "Traditional Costume": "Zuger Tracht",
            "Unique Fact": "Low corporate tax rates"
        },
        "ZÃ¼rich": {
            "Population (2022)": "1,520,000",
            "Capital": "ZÃ¼rich",
            "Official Language": "German",
            "Year Joined": "1351",
            "Area (kmÂ²)": "1,729",
            "Highest Point": "HÃ¶chrohne (1,293m)",
            "Famous Dish": "ZÃ¼rcher Geschnetzeltes",
            "Traditional Festival": "Street Parade",
            "Bordering Cantons (names)": "Aargau, Schaffhausen, Thurgau, St. Gallen, Schwyz, Zug",
            "Bordering Cantons (no)": "6",
            "Famous Person": "Max Frisch",
            "Notable Landmark": "GrossmÃ¼nster",
            "Main Industries": "Banking",
            "UNESCO Heritage": "None",
            "Lake/River": "Lake Zurich",
            "Mountain Pass": "None",
            "Nickname": "The Economic Powerhouse",
            "Traditional Costume": "ZÃ¼rcher Tracht",
            "Unique Fact": "Switzerland's largest city"
        }
    }
    return cantons

# Generate questions for each canton at different difficulty levels
def generate_questions(canton_data):
    questions = []
    for canton, attributes in canton_data.items():
        # Difficulty 10 (hardest) - Unique fact
        questions.append({
            "canton": canton,
            "difficulty": 10,
            "question": f"Unique fact: {attributes['Unique Fact']}",
            "answer": canton
        })
        
        # Difficulty 9 - Nickname
        questions.append({
            "canton": canton,
            "difficulty": 9,
            "question": f"Nickname: {attributes['Nickname']}",
            "answer": canton
        })
        
        # Difficulty 8 - Traditional costume
        questions.append({
            "canton": canton,
            "difficulty": 8,
            "question": f"Traditional costume: {attributes['Traditional Costume']}",
            "answer": canton
        })
        
        # Difficulty 7 - Mountain pass or notable geographic feature
        geo_feature = attributes['Mountain Pass'] if attributes['Mountain Pass'] != 'None' else attributes['Lake/River']
        questions.append({
            "canton": canton,
            "difficulty": 7,
            "question": f"Geographic feature: {geo_feature}",
            "answer": canton
        })
        
        # Difficulty 6 - UNESCO Heritage or notable landmark
        landmark = attributes['Notable Landmark'] if attributes['UNESCO Heritage'] == 'None' else attributes['UNESCO Heritage']
        questions.append({
            "canton": canton,
            "difficulty": 6,
            "question": f"Landmark: {landmark}",
            "answer": canton
        })
        
        # Difficulty 5 - Famous person or main industries
        if attributes['Famous Person'] != "-":
            questions.append({
                "canton": canton,
                "difficulty": 5,
                "question": f"Famous person: {attributes['Famous Person']}",
                "answer": canton
            })
        else:
            questions.append({
                "canton": canton,
                "difficulty": 5,
                "question": f"Main industries: {attributes['Main Industries']}",
                "answer": canton
            })
        
        # Difficulty 4 - Bordering cantons
        questions.append({
            "canton": canton,
            "difficulty": 4,
            "question": f"Borders {attributes['Bordering Cantons (no)']} cantons: {attributes['Bordering Cantons (names)']}",
            "answer": canton
        })
        
        # Difficulty 3 - Traditional festival or famous dish
        if attributes['Traditional Festival'] != "None":
            questions.append({
                "canton": canton,
                "difficulty": 3,
                "question": f"Traditional festival: {attributes['Traditional Festival']}",
                "answer": canton
            })
        else:
            questions.append({
                "canton": canton,
                "difficulty": 3,
                "question": f"Famous dish: {attributes['Famous Dish']}",
                "answer": canton
            })
        
        # Difficulty 2 - Capital and year joined
        questions.append({
            "canton": canton,
            "difficulty": 2,
            "question": f"Capital: {attributes['Capital']} (joined Switzerland in {attributes['Year Joined']})",
            "answer": canton
        })
        
        # Difficulty 1 (easiest) - Population and area
        questions.append({
            "canton": canton,
            "difficulty": 1,
            "question": f"Population: {attributes['Population (2022)']}, Area: {attributes['Area (kmÂ²)']} kmÂ²",
            "answer": canton
        })
    
    return pd.DataFrame(questions)

# Initialize session state
def init_session_state():
    if "rounds" not in st.session_state:
        st.session_state.rounds = 0
        st.session_state.score = 0
        st.session_state.current_round = 0
        st.session_state.round_cantons = []
        st.session_state.current_difficulty = 10
        st.session_state.pending_score = 10
        st.session_state.current_question = None
        st.session_state.correct = False
        st.session_state.hints = []
        st.session_state.attempts_left = 2
        st.session_state.round_start_time = time.time()
        st.session_state.round_finished = False
        st.session_state.reveal_message = ""
        st.session_state.feedback_message = ""

# Display start screen
def show_start_screen(df):
    st.title("ðŸ‡¨ðŸ‡­ Canton Guessing Game")
    st.write("Test your knowledge of Swiss cantons!")
    st.write("You'll get hints of varying difficulty. Fewer hints = more points!")
    
    st.write("Choose number of rounds:")
    rounds = st.radio("Rounds", [4, 8, 12], horizontal=True)
    
    if st.button("Start Game"):
        st.session_state.rounds = rounds
        st.session_state.round_cantons = random.sample(df["canton"].unique().tolist(), rounds)
        st.session_state.round_start_time = time.time()
        st.rerun()

# Display game round
def show_game_round(df):
    if not st.session_state.round_finished:
        st_autorefresh(interval=1000, limit=45, key="auto_refresh")

    input_key = f"guess_input_{st.session_state.current_round}"
    if st.session_state.get("clear_guess", False):
        st.session_state[input_key] = ""
        st.session_state.clear_guess = False

    st.title(f"Round {st.session_state.current_round + 1} of {st.session_state.rounds}")
    st.write(f"Score: {st.session_state.score}")
    st.write(f"Remaining attempts: {st.session_state.attempts_left}")
    remaining_time = max(0, int(45 - (time.time() - st.session_state.round_start_time)))
    st.write(f"â³ Time remaining: {remaining_time} seconds")

    current_canton = st.session_state.round_cantons[st.session_state.current_round]

    # Timeout check
    if not st.session_state.round_finished and remaining_time == 0:
        st.session_state.feedback_message = "â±ï¸ Time's up!"
        st.session_state.round_finished = True
        st.session_state.reveal_message = f"The correct answer was: {current_canton}"

    # Load first hint if none yet
    if not st.session_state.hints and not st.session_state.round_finished:
        first_hint = df[
            (df["canton"] == current_canton) &
            (df["difficulty"] == st.session_state.current_difficulty)
        ].iloc[0]
        st.session_state.current_question = first_hint
        st.session_state.hints.append(first_hint["question"])

    # Show all hints so far
    st.subheader("Hints so far:")
    for hint in st.session_state.hints:
        st.write(f"- {hint}")

    # Show feedback message
    if st.session_state.feedback_message:
        st.info(st.session_state.feedback_message)

    if not st.session_state.round_finished:
        col1, col2 = st.columns(2)

        with col1:
            guess = st.text_input("Your Guess:", key=input_key)
            if guess:
                if guess.strip().lower() == current_canton.lower():
                    st.session_state.feedback_message = f"âœ… Correct! You earned {st.session_state.pending_score} points."
                    st.session_state.score += st.session_state.pending_score
                    st.session_state.round_finished = True
                    st.session_state.clear_guess = True
                    st.rerun()
                else:
                    st.session_state.attempts_left -= 1
                    st.session_state.clear_guess = True
                    if st.session_state.attempts_left == 0:
                        st.session_state.feedback_message = "âŒ No attempts left."
                        st.session_state.round_finished = True
                        st.session_state.reveal_message = f"The correct answer was: {current_canton}"
                    else:
                        st.session_state.feedback_message = f"âŒ Wrong guess. {st.session_state.attempts_left} attempt(s) left."
                    st.rerun()

        with col2:
            if st.button("Next Hint"):
                if st.session_state.current_difficulty > 1:
                    st.session_state.current_difficulty -= 1
                    st.session_state.pending_score -= 1

                    next_hint = df[
                        (df["canton"] == current_canton) &
                        (df["difficulty"] == st.session_state.current
